"use strict";(()=>{var e={};e.id=399,e.ids=[399],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},882:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>A,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>x,staticGenerationAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{OPTIONS:()=>p.Y,POST:()=>c});var i=t(9303),o=t(8716),n=t(670);let a=require("crypto");var u=t(7070),l=t(474),p=t(6172),d=t(446);async function c(e,{params:r}){let t=await (0,d.xn)(e);if(!t)return(0,p.e)(u.NextResponse.json({error:"Not signed in"},{status:401}));let s=(0,l.j)(),{error:i}=await s.from("listings").select("id").eq("id",r.id).eq("user_id",t.id).single();if(i)return(0,p.e)(u.NextResponse.json({error:i.message},{status:404}));let o=(0,a.randomUUID)(),n=`${t.id}/${r.id}/${o}.jpg`,{data:c,error:g}=await s.storage.from("listing-images").createSignedUploadUrl(n);return g||!c?(0,p.e)(u.NextResponse.json({error:g?.message||"upload url err"},{status:400})):(0,p.e)(u.NextResponse.json({uploadUrl:c.signedUrl,token:c.token,path:n}))}let g=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/listings/[id]/upload-url/route",pathname:"/api/listings/[id]/upload-url",filename:"route",bundlePath:"app/api/listings/[id]/upload-url/route"},resolvedPagePath:"/Users/brooks/Desktop/sales-booster/app/api/listings/[id]/upload-url/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:m,serverHooks:x}=g,h="/api/listings/[id]/upload-url/route";function A(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:m})}},6172:(e,r,t)=>{t.d(r,{Y:()=>n,e:()=>o});var s=t(7070);let i=process.env.ALLOWED_ORIGIN||"*";function o(e){return e.headers.set("Access-Control-Allow-Origin",i),e.headers.set("Access-Control-Allow-Headers","Content-Type, Authorization"),e.headers.set("Access-Control-Allow-Methods","GET, POST, OPTIONS"),e.headers.set("Access-Control-Allow-Credentials","true"),e}function n(){return o(new s.NextResponse(null,{status:204}))}},446:(e,r,t)=>{t.d(r,{Rf:()=>a,w1:()=>n,xn:()=>o});var s=t(474);let i="sb-user";async function o(e){let r=e.cookies.get(i)?.value;if(!r)return null;let t=function(e){try{let r=Buffer.from(e,"base64url").toString("utf8"),t=JSON.parse(r);if("string"==typeof t?.id)return t.id}catch{}return null}(r);if(!t)return null;let o=(0,s.j)(),{data:n,error:a}=await o.from("users").select("id, email").eq("id",t).single();return a||!n?null:{id:n.id,email:n.email??null}}function n(e,r){let t=Buffer.from(JSON.stringify({id:r.id})).toString("base64url");e.cookies.set({name:i,value:t,httpOnly:!0,sameSite:"lax",secure:!0,path:"/",maxAge:2592e3})}function a(e){e.cookies.set({name:i,value:"",path:"/",maxAge:0})}},474:(e,r,t)=>{t.d(r,{j:()=>o});var s=t(3974);let i=process.env.SUPABASE_SERVICE_ROLE;function o(){return(0,s.eI)("https://omihukbgebxialwqhekb.supabase.co",i)}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,376],()=>t(882));module.exports=s})();
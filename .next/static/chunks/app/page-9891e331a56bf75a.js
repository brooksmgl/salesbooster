(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2807:function(e,t,i){Promise.resolve().then(i.bind(i,3654))},3654:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return v}});var s=i(7437),l=i(2265);function n(e){let t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");return(t=(t=(t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>")).replace(/(^|[^\*])\*(?!\*)([^*]+?)\*(?=$|[^\*])/g,(e,t,i)=>"".concat(t,"<em>").concat(i,"</em>"))).replace(/^Q:\s*/i,"<strong>Q:</strong> ")).replace(/^A:\s*/i,"<strong>A:</strong> ")}function r(e){let t=e.split(/\r?\n/),i=[],s=!1,l=()=>{s&&(i.push("</ul>"),s=!1)};for(let e of t){let t=e.trimEnd().trim();if(!t){l();continue}if(/^###\s+/.test(t)){l(),i.push("<h3>".concat(n(t.replace(/^###\s+/,"")),"</h3>"));continue}if(/^##\s+/.test(t)){l(),i.push("<h2>".concat(n(t.replace(/^##\s+/,"")),"</h2>"));continue}if(/^#\s+/.test(t)){l(),i.push("<h1>".concat(n(t.replace(/^#\s+/,"")),"</h1>"));continue}if(/^[-•]\s+/.test(t)){s||(i.push('<ul class="sb-list">'),s=!0),i.push("<li>".concat(n(t.replace(/^[-•]\s+/,"")),"</li>"));continue}if(/^[A-Za-z0-9 &]+:\s*$/.test(t)){l(),i.push("<h4>".concat(n(t.replace(/:$/,"")),"</h4>"));continue}l(),i.push("<p>".concat(n(t),"</p>"))}return l(),i.join("")}let a="max-w-[75%] rounded-2xl bg-[#F3E7E2] px-4 py-3 text-sm text-slate-800",o="max-w-[75%] rounded-2xl bg-white px-4 py-3 text-sm text-slate-900",c=/uploaded image:\s*(https?:\/\/\S+)/i,d=e=>e.replace(/\[b\]/gi,"**").replace(/\[\/b\]/gi,"**").replace(/\[i\]/gi,"*").replace(/\[\/i\]/gi,"*").replace(/\[u\]|\[center\]|\[size=\d+\]/gi,"").replace(/\[\/u\]|\[\/center\]|\[\/size\]/gi,"");function u(e){let{message:t}=e,i=c.exec(t.content);if(i){let[,e]=i,l="user"===t.role?"text-slate-600":"text-slate-500",n="user"===t.role?"overflow-hidden rounded-lg border border-[#e6d7d0] bg-white":"overflow-hidden rounded-lg border border-border bg-white";return(0,s.jsx)("div",{className:"user"===t.role?a:o,children:(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide ".concat(l),children:"Uploaded image"}),(0,s.jsx)("div",{className:n,children:(0,s.jsx)("img",{src:e,alt:"Uploaded listing reference",className:"max-h-56 w-full object-cover"})})]})})}let l=r(d(t.content)),n="user"===t.role?"rich-text text-slate-800 [&>h3]:text-slate-600 [&>p]:text-slate-700 [&_.sb-bullet]:text-slate-700 [&>strong]:text-slate-900":"rich-text";return(0,s.jsx)("div",{className:"user"===t.role?a:o,children:(0,s.jsx)("div",{className:n,dangerouslySetInnerHTML:{__html:l}})})}let f=e=>"/api".concat(e),x="bg-panel border border-border rounded-xl p-5 flex flex-col min-h-0",h="bg-panel border border-border rounded-xl p-5 min-h-0",m="inline-flex items-center justify-center rounded-lg border border-transparent bg-accent px-4 py-2 text-sm font-semibold text-white transition hover:bg-accent/90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent disabled:cursor-not-allowed disabled:opacity-60",g="inline-flex items-center justify-center rounded-lg border border-transparent bg-accent px-3 py-2 text-xs font-semibold text-white transition hover:bg-accent/90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent disabled:cursor-not-allowed disabled:opacity-60",p="w-full rounded-lg border border-border bg-white px-4 py-3 text-sm text-slate-900 placeholder-muted transition focus:border-accent focus:outline-none focus:ring-2 focus:ring-accent/40 disabled:cursor-not-allowed disabled:opacity-60";async function b(e){try{return await e.json()}catch(e){return null}}function v(){var e;let[t,i]=(0,l.useState)(null),[n,r]=(0,l.useState)(!1),[a,o]=(0,l.useState)(!1),[c,d]=(0,l.useState)(null),[v,y]=(0,l.useState)(""),[j,N]=(0,l.useState)([]),[E,S]=(0,l.useState)(null),[k,C]=(0,l.useState)(""),[_,T]=(0,l.useState)(!1),[L,P]=(0,l.useState)(null),[D,U]=(0,l.useState)(null),O=(0,l.useRef)(null);async function A(){let e=v.trim();if(!e){d("Email is required.");return}o(!0),d(null);try{var t;let s=await fetch(f("/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e}),credentials:"include"}),l=await b(s);if(!s.ok)throw Error((null==l?void 0:l.error)||"Sign in failed");i(null!==(t=null==l?void 0:l.user)&&void 0!==t?t:null),y("")}catch(e){console.error(e),d(e.message||"Sign in failed")}finally{o(!1),r(!0)}}async function z(){o(!0);try{await fetch(f("/auth/login"),{method:"DELETE",credentials:"include"})}catch(e){console.error(e)}finally{i(null),N([]),S(null),d(null),y(""),o(!1)}}function I(e){d(e||"Session expired. Please sign in again."),i(null)}async function M(){if(t)try{let e=await fetch(f("/listings"),{credentials:"include"});if(401===e.status){I();return}if(!e.ok){let t=await b(e);throw Error((null==t?void 0:t.error)||"Error ".concat(e.status))}let t=await e.json();N(t.listings||[])}catch(e){console.error(e),P(e.message||"Failed to load listings")}}async function R(e){if(t)try{let t=await fetch(f("/listings/".concat(e)),{credentials:"include"});if(401===t.status){I();return}if(!t.ok){let e=await b(t);throw Error((null==e?void 0:e.error)||"Error ".concat(t.status))}let i=await t.json();S(i.listing),N(e=>Array.isArray(e)?e.some(e=>e.id===i.listing.id)?e.map(e=>e.id===i.listing.id?{...e,...i.listing}:e):[i.listing,...e]:[i.listing]);let s=new URL(window.location.href);s.searchParams.set("l",e),history.replaceState({},"",s.toString())}catch(e){console.error(e),P(e.message||"Failed to load listing")}}async function F(){if(!t){I("Please sign in to create a listing.");return}T(!0);try{let e=await fetch(f("/listings"),{method:"POST",headers:{"Content-Type":"application/json"},body:"{}",credentials:"include"});if(401===e.status){I();return}if(!e.ok){let t=await b(e);throw Error((null==t?void 0:t.error)||"Error ".concat(e.status))}let t=await e.json();await M(),await R(t.listing.id)}catch(e){console.error(e),P(e.message||"Error creating listing")}finally{T(!1)}}async function q(){if(!t){I();return}T(!0);try{await M(),S(null),C(""),P(null),U(null);let e=new URL(window.location.href);e.searchParams.delete("l"),history.replaceState({},"",e.toString())}finally{T(!1)}}async function B(e){if(!t){I();return}T(!0);try{let t=await fetch(f("/listings/".concat(e)),{method:"DELETE",credentials:"include"});if(401===t.status){I();return}if(!t.ok){let e=await b(t);throw Error((null==e?void 0:e.error)||"Error ".concat(t.status))}if(U(null),(null==E?void 0:E.id)===e){S(null);let e=new URL(window.location.href);e.searchParams.delete("l"),history.replaceState({},"",e.toString())}await M()}catch(e){console.error(e),P(e.message||"Delete failed")}finally{T(!1)}}async function K(){if(E||!t)return E;try{let e=await fetch(f("/listings"),{method:"POST",headers:{"Content-Type":"application/json"},body:"{}",credentials:"include"});if(401===e.status)return I(),null;if(!e.ok){let t=await b(e);throw Error((null==t?void 0:t.error)||"Error ".concat(e.status))}let t=await e.json();return S(t.listing),await M(),t.listing}catch(e){return console.error(e),P(e.message||"Error creating listing"),null}}async function $(e,i,s){if(!t){I();return}let l=null!=E?E:await K();if(l){T(!0);try{let t=await fetch(f("/listings/".concat(l.id,"/generate")),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:e,message:i,imageUrl:s}),credentials:"include"});if(401===t.status){I();return}if(!t.ok){let e=await b(t);throw Error((null==e?void 0:e.error)||"Error ".concat(t.status))}let n=await t.json();S(n.listing),N(e=>Array.isArray(e)?e.some(e=>e.id===n.listing.id)?e.map(e=>e.id===n.listing.id?{...e,...n.listing}:e):[n.listing,...e]:[n.listing])}catch(e){console.error(e),P(e.message||"Generation failed")}finally{T(!1)}}}async function J(e){if(!t)return;let i=null!=E?E:await K();if(i)try{let t=await fetch(f("/listings/".concat(i.id,"/upload-url")),{method:"POST",credentials:"include"});if(401===t.status){I();return}if(!t.ok){let e=await b(t);throw Error((null==e?void 0:e.error)||"Error ".concat(t.status))}let{uploadUrl:s,path:l}=await t.json();if(!(await fetch(s,{method:"PUT",headers:{"Content-Type":e.type},body:e})).ok)throw Error("Upload failed");let n=await fetch(f("/listings/".concat(i.id,"/image-url")),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({path:l})});if(401===n.status){I();return}if(!n.ok){let e=await b(n);throw Error((null==e?void 0:e.error)||"Image sign error ".concat(n.status))}let{signedUrl:r}=await n.json();if(!r)throw Error("Missing signed image URL");await $("read",void 0,r)}catch(e){console.error(e),P(e.message||"Upload failed")}}function Q(e){e&&(navigator.clipboard.writeText(e),P("Copied"),setTimeout(()=>P(null),1200))}return(0,l.useEffect)(()=>{let e=new URLSearchParams(window.location.search).get("l");e&&(window.__restoreListingId=e)},[]),(0,l.useEffect)(()=>{function e(e){e.target.closest("[data-ellipsis-menu]")||U(null)}return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]),(0,l.useEffect)(()=>{(async()=>{try{let e=await fetch(f("/auth/session"),{credentials:"include"});if(e.ok){let t=await e.json();i(t.user),d(null)}else if(401===e.status)i(null);else{let t=await b(e);console.error("Session check failed",(null==t?void 0:t.error)||e.status)}}catch(e){console.error(e)}finally{r(!0)}})()},[]),(0,l.useEffect)(()=>{if(n){if(!t){N([]),S(null);return}(async()=>{await M();let e=window.__restoreListingId;e&&(await R(e),delete window.__restoreListingId)})()}},[n,t]),(0,s.jsx)("div",{className:"min-h-screen bg-background px-6 py-6 text-foreground",children:n?t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"grid h-[calc(100vh-48px)] grid-cols-[320px_minmax(0,1fr)_320px] gap-6",children:[(0,s.jsxs)("aside",{className:x,children:[(0,s.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-base font-semibold text-slate-900",children:"My Listings"}),(0,s.jsx)("button",{onClick:F,disabled:_||a,className:g,children:"+ New Listing"})]}),(0,s.jsx)("div",{className:"flex flex-col gap-3 overflow-y-auto pr-1",children:0===j.length?(0,s.jsx)("p",{className:"text-sm text-muted",children:"No listings yet. Create one to get started."}):j.map(e=>{let t=(null==E?void 0:E.id)===e.id;return(0,s.jsxs)("div",{role:"button",tabIndex:0,onClick:()=>{U(null),R(e.id)},onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),U(null),R(e.id))},className:"relative flex cursor-pointer items-center justify-between gap-3 rounded-xl border px-4 py-3 text-left transition focus:outline-none focus:ring-2 focus:ring-accent/40 ".concat(t?"border-accent ring-2 ring-accent/20":"border-border hover:border-accent/60"),children:[(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("span",{className:"text-sm font-semibold text-slate-900",children:e.title||"Untitled draft"}),(0,s.jsx)("span",{className:"text-xs text-muted",children:e.id.slice(0,8)})]}),(0,s.jsxs)("div",{className:"relative","data-ellipsis-menu":!0,children:[(0,s.jsx)("button",{type:"button","aria-label":"Listing options",className:"rounded-md p-1 text-slate-400 transition hover:bg-accentMuted/60 hover:text-slate-700",onClick:t=>{t.stopPropagation(),U(t=>t===e.id?null:e.id)},onKeyDown:e=>e.stopPropagation(),children:"⋮"}),D===e.id&&(0,s.jsx)("div",{className:"absolute right-0 top-full z-20 mt-2 flex min-w-[130px] flex-col rounded-md border border-border bg-white",children:(0,s.jsx)("button",{type:"button",className:"w-full rounded-md px-3 py-2 text-left text-sm font-semibold text-danger transition hover:bg-red-50",onClick:t=>{t.stopPropagation(),B(e.id)},children:"Delete"})})]})]},e.id)})})]}),(0,s.jsxs)("div",{className:"relative grid grid-rows-[auto_minmax(0,1fr)_auto] gap-4 overflow-hidden",children:[(0,s.jsxs)("section",{className:"".concat(h," flex items-center justify-between"),children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xl font-semibold text-slate-900",children:"Sales Booster"}),(0,s.jsx)("p",{className:"text-xs text-muted",children:"Etsy Listing Generator"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 text-xs text-muted",children:[(0,s.jsxs)("span",{children:["Signed in as ",t.email||"".concat(t.id.slice(0,8),"...")]}),(0,s.jsx)("button",{onClick:()=>void q(),disabled:_||a,className:g,children:"Refresh"}),(0,s.jsx)("button",{onClick:()=>void z(),disabled:a||_,className:"inline-flex items-center justify-center rounded-lg border border-border bg-white px-3 py-1.5 text-xs font-semibold text-slate-900 transition hover:bg-accentMuted focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent disabled:cursor-not-allowed disabled:opacity-60",children:"Sign out"})]})]}),(0,s.jsx)("section",{className:"".concat(h," flex flex-col overflow-hidden"),children:E?(0,s.jsx)("div",{className:"flex flex-col gap-3 overflow-y-auto pr-2",children:null===(e=E.chat_history)||void 0===e?void 0:e.map((e,t)=>(0,s.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,s.jsx)(u,{message:e})},t))}):(0,s.jsx)("p",{className:"text-sm text-muted",children:"Create or select a listing to start."})}),(0,s.jsx)("section",{className:h,children:(0,s.jsxs)("div",{className:"flex items-stretch gap-3",children:[(0,s.jsx)("input",{ref:O,type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t;let i=null===(t=e.target.files)||void 0===t?void 0:t[0];i&&J(i),O.current&&(O.current.value="")}}),(0,s.jsx)("button",{disabled:!E||_||a,className:m,onClick:()=>{var e;return null===(e=O.current)||void 0===e?void 0:e.click()},children:"Upload Image"}),(0,s.jsx)("input",{value:k,onChange:e=>C(e.target.value),placeholder:"Describe your product...",className:"".concat(p," flex-1"),disabled:a,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),E&&!_&&!a&&k&&(C(""),$("chat",k)))}}),(0,s.jsx)("button",{disabled:!E||_||a||!k,className:m,onClick:()=>{C(""),$("chat",k)},children:"Send"})]})}),_&&(0,s.jsx)("div",{className:"absolute inset-0 z-20 flex items-center justify-center rounded-xl bg-white/75",children:(0,s.jsx)("div",{className:"h-11 w-11 animate-spin rounded-full border-4 border-accent/30 border-t-accent",role:"status","aria-live":"polite","aria-label":"Loading"})})]}),(0,s.jsxs)("aside",{className:"".concat(x," overflow-y-auto"),children:[(0,s.jsx)("h2",{className:"mb-3 text-base font-semibold text-slate-900",children:"Listing Assets"}),(0,s.jsxs)("div",{className:"flex flex-col gap-3 pr-1",children:[(0,s.jsx)(w,{title:"Title",text:null==E?void 0:E.title,onCopy:()=>Q(null==E?void 0:E.title)}),(0,s.jsx)(w,{title:"Tags (13)",text:null==E?void 0:E.tags,onCopy:()=>Q(null==E?void 0:E.tags)}),(0,s.jsx)(w,{title:"Description (BB-code)",text:null==E?void 0:E.description,onCopy:()=>Q(null==E?void 0:E.description)}),(0,s.jsx)(w,{title:"FAQs",text:null==E?void 0:E.faqs,onCopy:()=>Q(null==E?void 0:E.faqs)})]})]})]}),L&&(0,s.jsx)("div",{className:"fixed bottom-6 left-1/2 z-30 -translate-x-1/2 transform rounded-xl border border-border bg-white px-4 py-2 text-sm font-semibold text-slate-900",children:L})]}):(0,s.jsx)("div",{className:"flex min-h-[80vh] items-center justify-center",children:(0,s.jsxs)("div",{className:"w-full max-w-md space-y-6 rounded-2xl border border-border bg-panel p-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold text-slate-900",children:"Sign in"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-muted",children:"Enter the email you use for Sales Booster listings."})]}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),A()},className:"space-y-3",children:[(0,s.jsx)("input",{value:v,onChange:e=>y(e.target.value),placeholder:"you@example.com",className:p,disabled:a,type:"email"}),(0,s.jsx)("button",{type:"submit",className:m,disabled:a,children:a?"Signing in...":"Continue"})]}),c&&(0,s.jsx)("div",{className:"text-sm font-semibold text-danger",children:c})]})}):(0,s.jsx)("div",{className:"flex min-h-[60vh] items-center justify-center",children:(0,s.jsx)("div",{className:"h-12 w-12 animate-spin rounded-full border-4 border-accent/30 border-t-accent",role:"status","aria-live":"polite","aria-label":"Checking session"})})})}function w(e){let{title:t,text:i,onCopy:l}=e;return(0,s.jsxs)("div",{className:"bg-panel border border-border rounded-xl p-4 min-h-0",children:[(0,s.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-slate-900",children:t}),(0,s.jsx)("button",{onClick:l,className:"inline-flex items-center justify-center rounded-lg border border-border bg-white px-2 py-1 text-xs font-semibold text-slate-900 transition hover:bg-accentMuted focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent disabled:cursor-not-allowed disabled:opacity-60",children:"Copy"})]}),function(e){if(!e)return(0,s.jsx)("span",{className:"text-sm text-muted",children:"—"});let t=e.replace(/\[b\]/gi,"**").replace(/\[\/b\]/gi,"**").replace(/\[i\]/gi,"*").replace(/\[\/i\]/gi,"*").replace(/\[u\]|\[center\]|\[size=\d+\]/gi,"").replace(/\[\/u\]|\[\/center\]|\[\/size\]/gi,"");return(0,s.jsx)("div",{className:"rich-text",dangerouslySetInnerHTML:{__html:r(t)}})}(i)]})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=2807)}),_N_E=e.O()}]);